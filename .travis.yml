os: osx
language: objective-c
osx_image: xcode9.4

cache: ccache

branches:
  only:
  - current

before_install:
- git checkout current
- export COLUMNS=80
- export PATH="/usr/local/opt/ccache/libexec:$PATH"
- wget https://raw.githubusercontent.com/GiovanniBussi/macports-ci/master/macports-ci
- chmod +x ./macports-ci
- ./macports-ci install
- export PATH=/opt/local/bin:/opt/local/sbin:$PATH

before_script:
- sudo port --follow-dependencies install autoconf213 ccache libidl clang-10 nodejs14 cmake gmake gnutar python38 pkgconfig nasm yasm
- curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --default-toolchain 1.45.1-x86_64-apple-darwin
- export PATH=$PATH:~/.cargo/bin
- cargo install cbindgen

script:
- export MOZCONFIG=.mozconfig
- ./mach build
- ./mach package
