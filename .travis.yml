os: osx
language: cpp
osx_image: xcode7.3
compiler: clang
cache: ccache

branches:
  only:
  - current

before_install:
- export COLUMNS=80
- wget https://raw.githubusercontent.com/aeiouaeiouaeiouaeiouaeiouaeiou/macports-ci/master/macports-ci
- chmod +x ./macports-ci
- ./macports-ci install
- export PATH=/opt/local/bin:/opt/local/sbin:$PATH

before_script:
- sudo port -N install autoconf213 ccache gmake gnutar clang-11 pkgconfig python38 nodejs14 nasm yasm
- sudo port select --set clang mp-clang-11
- sudo port select --set llvm mp-llvm-11
- sudo port select --set python3 python38
- export LLVM_CONFIG=/opt/local/bin/llvm-config
- curl --proto '=https' -sSf https://sh.rustup.rs | sh -s -- -y --default-toolchain stable-x86_64-apple-darwin
- export PATH=$PATH:~/.cargo/bin
- cargo install cbindgen

script:
- ./mach build
- ./mach package
- ./mach package-multi-locale --locales ach af an ar ast az be bg bn br bs ca ca-valencia cak cs cy da de dsb el en-CA en-GB en-US eo es-AR es-CL es-ES es-MX et eu fa ff fi fr fy-NL ga-IE gd gl gn gu-IN he hi-IN hr hsb hu hy-AM ia id is it ja-JP-mac ka kab kk km kn ko lij lt lv mk mr ms my nb-NO ne-NP nl nn-NO oc pa-IN pl pt-BR pt-PT rm ro ru si sk sl son sq sr sv-SE ta te th tl tr trs uk ur uz vi xh zh-CN zh-TW